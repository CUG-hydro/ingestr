<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Examples for ingestr • ingestr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Examples for ingestr">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ingestr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/example.html">Examples for ingestr</a>
    </li>
    <li>
      <a href="../articles/rsconnect/documents/example.html">UNKNOWN TITLE</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/stineb/ingestr">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Examples for ingestr</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/stineb/ingestr/blob/master/vignettes/example.Rmd"><code>vignettes/example.Rmd</code></a></small>
      <div class="hidden name"><code>example.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>The package <code>ingestr</code> provides functions to extract (ingest) point data (given longitude, latitude, and required dates) from large global files or remote data servers and create time series at user-specified temporal resolution. This can be done for a set of sites at once, given a data frame containing the meta info for each site (see data frame <code>siteinfo</code>, with columns <code>lon</code> for longitude, <code>lat</code> for latitude, <code>date_start</code> and <code>date_end</code> specifying required dates). The output for such a set of site-level data is a nested data frame with rows for each site and columns <code>lon</code>, <code>lat</code>, <code>date_start</code>, and <code>date_end</code> plus an added column where the time series of ingested data is nested inside.</p>
<p>Data can be ingested for different data types (argument <code>source</code> in several functions), each dealing with a specific format of the original data and specific functions to read from respective files or remote servers. The following data types can be handled currently (more to be added by you if you like):</p>
<p>Meteo data:</p>
<ul>
<li>FLUXNET (also flux data can be read in)</li>
<li>WATCH-WFDEI</li>
<li>CRU</li>
</ul>
<p>Data on Google Earth Engine (using Koen Hufken’s <code>gee_suset</code> library):</p>
<ul>
<li>MODIS FPAR</li>
<li>MODIS EVI</li>
<li>MODIS GPP</li>
</ul>
<p>MODIS data (not yet implemented):</p>
<ul>
<li>RModisTools R package to access data on remote server ORNL DAAC (not yet implemented).</li>
</ul>
<p>Examples to read data for a single site for each data type are given in Section ‘Examples for a single site’. Handling ingestion for multiple sites is descrbed in Section ‘Example for a set of sites’.</p>
</div>
<div id="examples-for-a-single-site" class="section level2">
<h2 class="hasAnchor">
<a href="#examples-for-a-single-site" class="anchor"></a>Examples for a single site</h2>
<div id="fluxnet-2015" class="section level3">
<h3 class="hasAnchor">
<a href="#fluxnet-2015" class="anchor"></a>FLUXNET 2015</h3>
<p>Reading from FLUXNET 2015 files offers additional settings to be used specifically. Here, we’re specifying that no soil water content data is read, and that half-hourly data is stored in a separate directory. The latter specification is used to derive daytime VPD which is not given in FLUXNET 2015 data, but required here (see <code>getvars</code> element <code>vpd  = "VPD_F_DAY"</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">settings_fluxnet &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="dt">dir_hh =</span> <span class="st">"~/data/FLUXNET-2015_Tier1/20191024/HH/"</span>, 
  <span class="dt">getswc =</span> <span class="ot">FALSE</span>)

df_fluxnet &lt;-<span class="st"> </span>ingestr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ingestr/man/ingest_bysite.html">ingest_bysite</a></span>(
  <span class="dt">sitename =</span> <span class="st">"CH-Lae"</span>,
  <span class="dt">source =</span> <span class="st">"fluxnet2015"</span>,
  <span class="dt">getvars =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">temp =</span> <span class="st">"TA_F_DAY"</span>, 
                 <span class="dt">prec =</span> <span class="st">"P_F"</span>, 
                 <span class="dt">vpd  =</span> <span class="st">"VPD_F_DAY"</span>, 
                 <span class="dt">swin =</span>  <span class="st">"SW_IN_F"</span>, 
                 <span class="dt">netrad =</span> <span class="st">"NETRAD"</span>, 
                 <span class="dt">patm =</span> <span class="st">"PA_F"</span>),
  <span class="dt">dir =</span> <span class="st">"~/data/FLUXNET-2015_Tier1/20191024/DD/"</span>,
  <span class="dt">settings =</span> settings_fluxnet,
  <span class="dt">timescale =</span> <span class="st">"d"</span>,
  <span class="dt">year_start =</span> <span class="dv">2010</span>,
  <span class="dt">year_end =</span> <span class="dv">2012</span>,
  <span class="dt">verbose =</span> <span class="ot">FALSE</span>
  )</code></pre></div>
<pre><code>## Warning in as.POSIXlt.POSIXct(x, tz): unknown timezone 'zone/tz/2019c.1.0/
## zoneinfo/Europe/Zurich'</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_fluxnet</code></pre></div>
<pre><code>## # A tibble: 1,095 x 9
##    date        temp  prec    vpd     swin netrad  patm   ppfd sitename
##    &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   
##  1 2010-01-01  1.50 4.62    7.81 2019773.     NA 91032  4.12  CH-Lae  
##  2 2010-01-02 -5.10 3.04   49.0  4958755.     NA 92928 10.1   CH-Lae  
##  3 2010-01-03 -5.22 0.001 133.   6840288      NA 93320 14.0   CH-Lae  
##  4 2010-01-04 -5.94 0      92.3  6632064      NA 92687 13.5   CH-Lae  
##  5 2010-01-05 -7.96 0      27.3  3333658.     NA 91863  6.80  CH-Lae  
##  6 2010-01-06 -6.33 1.11    9.04 1200528.     NA 91607  2.45  CH-Lae  
##  7 2010-01-07 -3.77 0.091  44.8  5301936      NA 92168 10.8   CH-Lae  
##  8 2010-01-08 -5.78 3.79   10.1   594691.     NA 92003  1.21  CH-Lae  
##  9 2010-01-09 -8.32 2.38   16.6   427507.     NA 91824  0.872 CH-Lae  
## 10 2010-01-10 -7.78 0.724  32.1  1383005.     NA 92482  2.82  CH-Lae  
## # … with 1,085 more rows</code></pre>
</div>
<div id="watch-wfdei" class="section level3">
<h3 class="hasAnchor">
<a href="#watch-wfdei" class="anchor"></a>WATCH-WFDEI</h3>
<p>Let’s extract data for the location corresponding to FLUXNET site ‘CH-Lae’ (lon = 8.365, lat = 47.4781).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_watch &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span>(
  <span class="dt">sitename =</span> <span class="st">"CH-Lae"</span>,
  <span class="dt">source =</span> <span class="st">"watch_wfdei"</span>,
  <span class="dt">getvars   =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">temp =</span> <span class="st">"Tair"</span>),
  <span class="dt">dir       =</span> <span class="st">"~/data/watch_wfdei/"</span>,
  <span class="dt">timescale =</span> <span class="st">"d"</span>,
  <span class="dt">year_start =</span> <span class="dv">2010</span>,
  <span class="dt">year_end =</span> <span class="dv">2012</span>,
  <span class="dt">lon =</span> <span class="fl">8.365</span>,
  <span class="dt">lat =</span> <span class="fl">47.4781</span>,
  <span class="dt">verbose =</span> <span class="ot">FALSE</span>
  )</code></pre></div>
<pre><code>## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"
## [1] "vobjtovarid4: **** WARNING **** I was asked to get a varid for dimension named tstep BUT this dimension HAS NO DIMVAR! Code will probably fail at this point"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_watch</code></pre></div>
<pre><code>## # A tibble: 1,095 x 3
##    sitename  temp date      
##    &lt;chr&gt;    &lt;dbl&gt; &lt;date&gt;    
##  1 CH-Lae    1.32 2010-01-01
##  2 CH-Lae   -3.77 2010-01-02
##  3 CH-Lae   -4.33 2010-01-03
##  4 CH-Lae   -4.53 2010-01-04
##  5 CH-Lae   -3.27 2010-01-05
##  6 CH-Lae   -2.71 2010-01-06
##  7 CH-Lae   -2.66 2010-01-07
##  8 CH-Lae   -3.47 2010-01-08
##  9 CH-Lae   -4.70 2010-01-09
## 10 CH-Lae   -4.71 2010-01-10
## # … with 1,085 more rows</code></pre>
</div>
<div id="cru" class="section level3">
<h3 class="hasAnchor">
<a href="#cru" class="anchor"></a>CRU</h3>
<p>As above, let’s extract CRU data for the location corresponding to FLUXNET site ‘CH-Lae’ (lon = 8.365, lat = 47.4781). Note that we’re using <code>tmx</code> (the daily maximum temperature).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_cru &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span>(
  <span class="dt">sitename =</span> <span class="st">"CH-Lae"</span>,
  <span class="dt">source =</span> <span class="st">"cru"</span>,
  <span class="dt">getvars   =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">temp =</span> <span class="st">"tmx"</span>),
  <span class="dt">dir       =</span> <span class="st">"~/data/cru/ts_4.01/"</span>,
  <span class="dt">timescale =</span> <span class="st">"d"</span>,
  <span class="dt">year_start =</span> <span class="dv">2010</span>,
  <span class="dt">year_end =</span> <span class="dv">2012</span>,
  <span class="dt">lon =</span> <span class="fl">8.365</span>,
  <span class="dt">lat =</span> <span class="fl">47.4781</span>,
  <span class="dt">verbose =</span> <span class="ot">FALSE</span>
  )</code></pre></div>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: tmx
## If that is not correct, you can set it to one of: tmx, stn</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_cru</code></pre></div>
<pre><code>## # A tibble: 1,095 x 3
##    date          temp sitename
##    &lt;date&gt;       &lt;dbl&gt; &lt;chr&gt;   
##  1 2010-01-01  0.511  CH-Lae  
##  2 2010-01-02  0.343  CH-Lae  
##  3 2010-01-03  0.189  CH-Lae  
##  4 2010-01-04  0.0493 CH-Lae  
##  5 2010-01-05 -0.0769 CH-Lae  
##  6 2010-01-06 -0.189  CH-Lae  
##  7 2010-01-07 -0.288  CH-Lae  
##  8 2010-01-08 -0.373  CH-Lae  
##  9 2010-01-09 -0.444  CH-Lae  
## 10 2010-01-10 -0.501  CH-Lae  
## # … with 1,085 more rows</code></pre>
<p>We can compare the temperature recorded at the site and the temperature data extracted from WATCH-WFDEI.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span>df_fluxnet <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">temp_fluxnet =</span> temp) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">left_join</span>(<span class="kw">rename</span>(df_watch, <span class="dt">temp_watch =</span> temp), <span class="dt">by =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"sitename"</span>, <span class="st">"date"</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">left_join</span>(<span class="kw">rename</span>(df_cru, <span class="dt">temp_cru =</span> temp), <span class="dt">by =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"sitename"</span>, <span class="st">"date"</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(temp_fluxnet, temp_watch, temp_cru), <span class="dt">names_to =</span> <span class="st">"source"</span>, <span class="dt">values_to =</span> <span class="st">"temp"</span>, <span class="dt">names_prefix =</span> <span class="st">"temp_"</span>)

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)
df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> date, <span class="dt">y =</span> temp, <span class="dt">color =</span> source)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>()</code></pre></div>
<p><img src="example_files/figure-html/unnamed-chunk-4-1.png" width="700"> Looks sweet.</p>
</div>
<div id="google-earth-engine" class="section level3">
<h3 class="hasAnchor">
<a href="#google-earth-engine" class="anchor"></a>Google Earth Engine</h3>
<p>The library <code>gee_subset</code> by Koen Hufkens can be downloaded from this <a href="https://khufkens.github.io/gee_subset/">link</a> and used to extract data directly from Google Earth Engine. Note that this requires the following programmes to be available:</p>
<ul>
<li>git: You can use <a href="https://brew.sh/">Homebrew</a> to installing git by entering in your terminal: <code>brew install git</code>.</li>
<li><a href="https://www.python.org/">python</a></li>
</ul>
<p>Then, carry out the follwing steps:</p>
<ul>
<li>In your terminal, change to where you want to have the repository. In this example, we’re cloning it into our home directory:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="bu">cd</span> ~
<span class="fu">git</span> clone https://github.com/khufkens/google_earth_engine_subsets.git</code></pre></div>
<p>To get access to using the Google Earth Engine API (required to use the <code>gee_subset</code> library), carry out the following steps in your terminal. This follows steps described <a href="https://github.com/google/earthengine-api/issues/27">here</a>.</p>
<ol style="list-style-type: decimal">
<li>Install google API Python client</li>
</ol>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="fu">sudo</span> pip install --upgrade google-api-python-client</code></pre></div>
<p>I had an error and first had to do this here following <a href="https://github.com/pypa/pip/issues/3165">this link</a>:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="fu">sudo</span> pip install --ignore-installed six</code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Install pyCrypto</li>
</ol>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="fu">sudo</span> pip install pyCrypto --upgrade</code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Install Python GEE API</li>
</ol>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="fu">sudo</span> pip install earthengine-api</code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Run authentification for GEE</li>
</ol>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">earthengine</span> authenticate</code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Finally, try if it works. This shouldn’t return an error:</li>
</ol>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">python</span> -c <span class="st">"import ee; ee.Initialize()"</span></code></pre></div>
<div id="modis-fpar" class="section level4">
<h4 class="hasAnchor">
<a href="#modis-fpar" class="anchor"></a>MODIS FPAR</h4>
<p>To facilitate the selection of data products and bands to be downloaded, you may use the function <code><a href="../reference/get_settings_gee.html">get_settings_gee()</a></code> which defines defaults for different data bundles (<code><a href="https://rdrr.io/r/base/c.html">c("modis_fpar", "modis_evi", "modis_lai", "modis_gpp")</a></code> are available). The following example is for downloading MODIS FPAR data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">settings_gee &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_settings_gee.html">get_settings_gee</a></span>( 
  <span class="dt">bundle =</span> <span class="st">"modis_fpar"</span>, 
  <span class="dt">python_path =</span> <span class="kw"><a href="https://rdrr.io/r/base/system.html">system</a></span>(<span class="st">"which python"</span>, <span class="dt">intern =</span> <span class="ot">TRUE</span>),
  <span class="dt">gee_path =</span> <span class="st">"~/google_earth_engine_subsets/gee_subset/"</span>,
  <span class="dt">data_path =</span> <span class="st">"~/data/gee_subsets/"</span>,
  <span class="dt">splined =</span> <span class="ot">TRUE</span>,
  <span class="dt">do_plot_interpolated =</span> <span class="ot">FALSE</span>,
  <span class="dt">overwrite_raw =</span> <span class="ot">FALSE</span>,
  <span class="dt">overwrite_interpol =</span> <span class="ot">FALSE</span>
  )</code></pre></div>
<p>This can now be used to download the data to the directory specified by argument <code>data_path</code> of function <code><a href="../reference/get_settings_gee.html">get_settings_gee()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_gee_modis_fpar &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span>(
  <span class="dt">sitename =</span> <span class="st">"CH-Lae"</span>,
  <span class="dt">source =</span> <span class="st">"gee"</span>,
  <span class="dt">year_start =</span> <span class="dv">2010</span>,
  <span class="dt">year_end =</span> <span class="dv">2012</span>,
  <span class="dt">lon =</span> <span class="fl">8.365</span>,
  <span class="dt">lat =</span> <span class="fl">47.4781</span>,
  <span class="dt">settings =</span> settings_gee,
  <span class="dt">verbose =</span> <span class="ot">FALSE</span>
  )</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   date = col_date(format = ""),
##   year_dec = col_double(),
##   doy = col_double(),
##   modisvar = col_double(),
##   data_loess = col_double(),
##   spline = col_double(),
##   interpl = col_double(),
##   sgfiltered = col_double(),
##   modisvar_interpol = col_double()
## )</code></pre>
<p>Plot this data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_gee_modis_fpar <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> date)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">y =</span> modisvar)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">y =</span> modisvar_interpol), <span class="dt">col =</span> <span class="st">'red'</span>)</code></pre></div>
<pre><code>## Warning: Removed 836 rows containing missing values (geom_point).</code></pre>
<p><img src="example_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
</div>
</div>
</div>
<div id="examples-for-a-site-ensemble" class="section level2">
<h2 class="hasAnchor">
<a href="#examples-for-a-site-ensemble" class="anchor"></a>Examples for a site ensemble</h2>
<p>To collect data from an ensemble of sites, we have to define a meta data frame, here called <code>siteinfo</code>, with rows for each site and columns <code>lon</code> for longitude, <code>lat</code> for latitude, <code>date_start</code> and <code>date_end</code> for required dates (Dates are objects returned by a <code><a href="http://lubridate.tidyverse.org/reference/ymd.html">lubridate::ymd()</a></code> function call - this stands for year-month-day). The function <code><a href="../reference/ingest.html">ingest()</a></code> can then be used to collect all site-level data as a nested data frame corresponding to the metadata <code>siteinfo</code> with an added column named <code>data</code> where the time series of ingested data is nested inside.</p>
<p>Note that extracting for an ensemble of sites at once is more efficient for data types that are global files (WATCH-WFDEI, and CRU). In this case, the <code>raster</code> package can be used to efficiently ingest data.</p>
<p>First, define a list of sites and get site meta information. The required meta information is provided in file <code>"~/data/FLUXNET-2015_Tier1/siteinfo_fluxnet2015_sofun+whc.csv"</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mysites &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"BE-Vie"</span>, <span class="st">"DE-Tha"</span>, <span class="st">"DK-Sor"</span>, <span class="st">"FI-Hyy"</span>, <span class="st">"IT-Col"</span>, <span class="st">"NL-Loo"</span>, <span class="st">"US-MMS"</span>, <span class="st">"US-WCr"</span>, <span class="st">"US-UMB"</span>, <span class="st">"US-Syv"</span>, <span class="st">"DE-Hai"</span>)

siteinfo &lt;-<span class="st"> </span>readr<span class="op">::</span><span class="kw"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span>(<span class="st">"~/data/FLUXNET-2015_Tier1/siteinfo_fluxnet2015_sofun+whc.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">sitename =</span> mysitename) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(sitename <span class="op">%in%</span><span class="st"> </span>mysites) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date_start =</span> lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(year_start, <span class="st">"-01-01"</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date_end =</span> lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(year_end, <span class="st">"-12-31"</span>)))</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   mysitename = col_character(),
##   lon = col_double(),
##   lat = col_double(),
##   elv = col_double(),
##   year_start = col_double(),
##   year_end = col_double(),
##   years_data = col_double(),
##   classid = col_character(),
##   elv_watch = col_double(),
##   elv_diff = col_double(),
##   whc = col_double()
## )</code></pre>
<p>Next, the data can be ingested for all sites at once. Let’s do it for different data types again.</p>
<div id="fluxnet-2015-1" class="section level3">
<h3 class="hasAnchor">
<a href="#fluxnet-2015-1" class="anchor"></a>FLUXNET 2015</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ddf_fluxnet &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ingest.html">ingest</a></span>(
  <span class="dt">siteinfo =</span> siteinfo,
  <span class="dt">source    =</span> <span class="st">"fluxnet2015"</span>,
  <span class="dt">getvars   =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">temp =</span> <span class="st">"TA_F_DAY"</span>, <span class="dt">prec =</span> <span class="st">"P_F"</span>, <span class="dt">vpd  =</span> <span class="st">"VPD_F_DAY"</span>, <span class="dt">swin =</span>  <span class="st">"SW_IN_F"</span>, <span class="dt">netrad =</span> <span class="st">"NETRAD"</span>, <span class="dt">patm =</span> <span class="st">"PA_F"</span>),
  <span class="dt">dir       =</span> <span class="st">"~/data/FLUXNET-2015_Tier1/20191024/DD/"</span>,
  <span class="dt">settings  =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">dir_hh =</span> <span class="st">"~/data/FLUXNET-2015_Tier1/20191024/HH/"</span>, <span class="dt">getswc =</span> <span class="ot">FALSE</span>, <span class="dt">threshold_GPP =</span> <span class="fl">0.5</span>),
  <span class="dt">timescale =</span> <span class="st">"d"</span>
  )</code></pre></div>
</div>
<div id="watch-wfdei-1" class="section level3">
<h3 class="hasAnchor">
<a href="#watch-wfdei-1" class="anchor"></a>WATCH-WFDEI</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ddf_watch &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ingest.html">ingest</a></span>(
  <span class="dt">siteinfo =</span> siteinfo,
  <span class="dt">source    =</span> <span class="st">"watch_wfdei"</span>,
  <span class="dt">getvars   =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">temp =</span> <span class="st">"Tair"</span>),
  <span class="dt">dir       =</span> <span class="st">"~/data/watch_wfdei/"</span>
  )</code></pre></div>
</div>
<div id="cru-1" class="section level3">
<h3 class="hasAnchor">
<a href="#cru-1" class="anchor"></a>CRU</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ddf_cru &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ingest.html">ingest</a></span>(
  <span class="dt">siteinfo =</span> siteinfo,
  <span class="dt">source    =</span> <span class="st">"cru"</span>,
  <span class="dt">getvars   =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">temp =</span> <span class="st">"tmx"</span>),
  <span class="dt">dir       =</span> <span class="st">"~/data/cru/ts_4.01/"</span>
  )</code></pre></div>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: tmx
## If that is not correct, you can set it to one of: tmx, stn</code></pre>
<p>Check it out for the first site (BE-Vie).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="dt">data =</span> ddf_fluxnet<span class="op">$</span>data[[<span class="dv">1</span>]], <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> date, <span class="dt">y =</span> temp)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="dt">data =</span> ddf_watch<span class="op">$</span>data[[<span class="dv">1</span>]], <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> date, <span class="dt">y =</span> temp), <span class="dt">col =</span> <span class="st">"royalblue"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="dt">data =</span> ddf_cru<span class="op">$</span>data[[<span class="dv">1</span>]], <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> date, <span class="dt">y =</span> temp), <span class="dt">col =</span> <span class="st">"red"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span>(<span class="kw">ymd</span>(<span class="st">"2000-01-01"</span>), <span class="kw">ymd</span>(<span class="st">"2005-12-31"</span>))</code></pre></div>
<pre><code>## Warning: Removed 4745 row(s) containing missing values (geom_path).

## Warning: Removed 4745 row(s) containing missing values (geom_path).

## Warning: Removed 4745 row(s) containing missing values (geom_path).</code></pre>
<p><img src="example_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<!-- ### rsofun input data -->
<!-- First read all FLUXNET meteo data. -->
<!-- ```{r message=FALSE, warning=FALSE} -->
<!-- ddf_fluxnet <- ingest( -->
<!--   siteinfo = siteinfo, -->
<!--   source    = "fluxnet2015", -->
<!--   getvars   = list(temp = "TA_F_DAY", prec = "P_F", vpd  = "VPD_F_DAY", swin =  "SW_IN_F", netrad = "NETRAD", patm = "PA_F"), -->
<!--   dir       = "~/data/FLUXNET-2015_Tier1/20191024/DD/", -->
<!--   settings  = list(dir_hh = "~/data/FLUXNET-2015_Tier1/20191024/HH/", getswc = FALSE, threshold_GPP = 0.5), -->
<!--   timescale = "d" -->
<!--   ) -->
<!-- ``` -->
<!-- Some meteo data is not available from FLUXNET. Extract it from WATCH-WFDEI global climate reanalysis files instead. -->
<!-- ```{r} -->
<!-- ddf_watch <- ingest( -->
<!--   siteinfo = siteinfo, -->
<!--   source    = "watch_wfdei", -->
<!--   getvars   = list(temp = "Tair"), -->
<!--   dir       = "~/data/watch_wfdei/" -->
<!--   ) -->
<!-- ``` -->
<!-- Some meteo data is not available from FLUXNET. Extract it from CRU global climate files instead. -->
<!-- ```{r} -->
<!-- ddf_cru <- ingest( -->
<!--   siteinfo = siteinfo, -->
<!--   source    = "cru", -->
<!--   getvars   = list(ccov = "cld"), -->
<!--   dir       = "~/data/cru/ts_4.01/" -->
<!--   ) -->
<!-- ``` -->
<!-- ### Evaluation data -->
<!-- ```{r message=FALSE, warning=FALSE} -->
<!-- ## get data for idfferent time scales separately -->
<!-- ddf_eval <- ingest( -->
<!--   siteinfo = siteinfo, -->
<!--   source    = "fluxnet2015", -->
<!--   getvars   = list(latenth = "LE_F_MDS", latenth_qc = "LE_F_MDS_QC"), -->
<!--   dir       = "~/data/FLUXNET-2015_Tier1/20191024/DD/", -->
<!--   settings  = list(threshold_LE = 0.8, getswc = TRUE), -->
<!--   timescale = "d" -->
<!--   ) -->
<!-- mdf_eval <- ingest( -->
<!--   siteinfo = siteinfo, -->
<!--   source    = "fluxnet2015", -->
<!--   getvars   = list(latenth = "LE_F_MDS", latenth_qc = "LE_F_MDS_QC"), -->
<!--   dir       = "~/data/FLUXNET-2015_Tier1/20191024/MM/", -->
<!--   settings  = list(threshold_LE = 0.8, getswc = TRUE), -->
<!--   timescale = "m" -->
<!--   ) -->
<!-- adf_eval <- ingest( -->
<!--   siteinfo = siteinfo, -->
<!--   source    = "fluxnet2015", -->
<!--   getvars   = list(latenth = "LE_F_MDS", latenth_qc = "LE_F_MDS_QC"), -->
<!--   dir       = "~/data/FLUXNET-2015_Tier1/20191024/YY/", -->
<!--   settings  = list(threshold_LE = 0.8, getswc = TRUE), -->
<!--   timescale = "y" -->
<!--   ) -->
<!-- ``` -->
<!-- Use rsofun to create a standardised object used for benchmarking the model output. -->
<!-- ```{r} -->
<!-- settings_eval <- list( -->
<!--   benchmark = list( latenth = c("fluxnet2015") ) -->
<!--   ) -->
<!-- obs_eval <- get_obs_eval2( settings_eval = settings_eval, adf = adf_eval, mdf = mdf_eval, ddf = ddf_eval ) -->
<!-- ``` -->
<!-- ### Calibration data -->
<!-- tbc -->
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#examples-for-a-single-site">Examples for a single site</a></li>
      <li><a href="#examples-for-a-site-ensemble">Examples for a site ensemble</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Benjamin Stocker.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
